<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Qu·∫£n Tr·ªã - T·ªï D√¢n Ph·ªë 21</title>
    <!-- CACHE BUSTING ADDED -->
    <link rel="stylesheet" href="admin.css?v=FIX_REALTIME_V1">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.2/tinymce.min.js" referrerpolicy="origin"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="db.js"></script>

    <!-- EMERGENCY STYLE OVERRIDE FOR LOGIN BACKGROUND -->
    <style>
        #login-overlay::before {
            /* Updated background image as requested */
            background-image: linear-gradient(to bottom, rgba(20, 10, 10, 0.4), rgba(40, 20, 20, 0.6)), url('https://media-cdn-v2.laodong.vn/storage/newsportal/2023/11/9/1265053/Ha-Noi-Mua-La-Rung-7.jpg') !important;
            filter: blur(3px) brightness(0.9) !important;
        }

        #login-overlay * {
            font-family: Arial, Helvetica, sans-serif !important;
        }
    </style>
    <style>
        /* --- MODAL WIDE & GRID LAYOUT --- */
        .modal-large {
            max-width: 1000px !important;
            width: 95% !important;
        }

        .modal-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-top: 10px;
        }

        .modal-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .modal-column-right {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            height: fit-content;
        }

        @media (max-width: 768px) {
            .modal-grid {
                grid-template-columns: 1fr;
            }

            .modal-large {
                padding: 20px;
                max-height: 90vh;
                overflow-y: auto;
            }
        }
    </style>
</head>

<body>
    <!-- LOGIN OVERLAY -->
    <!-- LOGIN OVERLAY (Redesigned) -->
    <div id="login-overlay">
        <div class="login-container">
            <div class="login-glass">
                <div class="login-header">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a3/Emblem_of_Vietnam.svg/1200px-Emblem_of_Vietnam.svg.png"
                        alt="Qu·ªëc Huy">
                    <h3>H·ªÜ TH·ªêNG QU·∫¢N TR·ªä S·ªê</h3>
                    <p>T·ªî D√ÇN PH·ªê 21 - P. BA ƒê√åNH</p>
                </div>
                <div class="login-body">
                    <div class="input-group">
                        <i class="fa-solid fa-user-shield"></i>
                        <input type="text" id="login-input" placeholder="Email ho·∫∑c T√™n ƒëƒÉng nh·∫≠p"
                            onkeyup="if(event.key==='Enter') document.getElementById('login-pass').focus()">
                    </div>
                    <div class="input-group">
                        <i class="fa-solid fa-key"></i>
                        <input type="password" id="login-pass" placeholder="M·∫≠t kh·∫©u b·∫£o m·∫≠t"
                            onkeyup="if(event.key==='Enter') attemptLogin()">
                    </div>

                    <button type="button" class="btn-login" onclick="attemptLogin()">
                        <span>ƒêƒÇNG NH·∫¨P</span>
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>

                    <a href="javascript:void(0)" onclick="toggleResetUI()"
                        style="display:block; text-align:right; margin-top:10px; color:#fff; font-size:13px; text-decoration:none;">Qu√™n
                        m·∫≠t kh·∫©u?</a>

                    <p id="login-msg" class="login-alert"></p>
                </div>

                <!-- RESET PASSWORD FORM (Hidden by default) -->
                <div class="login-body" id="reset-ui" style="display:none;">
                    <p style="color:white; font-size:13px; margin-bottom:15px; text-align:center;">Nh·∫≠p Email c·ªßa b·∫°n ƒë·ªÉ
                        nh·∫≠n li√™n k·∫øt ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u.</p>
                    <div class="input-group">
                        <i class="fa-solid fa-envelope"></i>
                        <input type="email" id="reset-email" placeholder="Email ƒëƒÉng k√Ω"
                            onkeyup="if(event.key==='Enter') sendResetEmail()">
                    </div>

                    <button type="button" class="btn-login" onclick="sendResetEmail()"
                        style="background:var(--primary-blue);">
                        <span>G·ª¨I Y√äU C·∫¶U</span>
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>

                    <a href="javascript:void(0)" onclick="toggleResetUI()"
                        style="display:block; text-align:center; margin-top:15px; color:#fff; font-size:13px; text-decoration:underline;">Quay
                        l·∫°i ƒêƒÉng nh·∫≠p</a>
                    <p id="reset-msg" class="login-alert"></p>
                </div>
                <div class="login-footer">
                    <small>Thi·∫øt k·∫ø & Ph√°t tri·ªÉn b·ªüi <b class="highlight-text">Chi ƒêo√†n 21</b> - B·∫£o m·∫≠t b·ªüi
                        Google</small>
                </div>
            </div>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="sidebar-header">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a3/Emblem_of_Vietnam.svg/1200px-Emblem_of_Vietnam.svg.png"
                alt="Logo">
            <span class="sidebar-title">QU·∫¢N TR·ªä VI√äN</span>
        </div>
        <ul class="nav-links">
            <div class="menu-item active" onclick="switchView('view-dashboard', this)">
                <i class="fa-solid fa-gauge"></i> <span>B·∫£ng ƒëi·ªÅu khi·ªÉn</span>
            </div>
            <div class="menu-item" onclick="switchView('view-articles', this)">
                <i class="fa-solid fa-newspaper"></i> <span>Qu·∫£n l√Ω tin b√†i</span>
            </div>
            <div class="menu-item" onclick="switchView('view-pages', this)">
                <i class="fa-solid fa-file-lines"></i> <span>Qu·∫£n l√Ω trang</span>
            </div>
            <div class="menu-item" onclick="switchView('view-feedback', this)">
                <i class="fa-solid fa-envelope-open-text"></i> <span>H·ªôp Th∆∞ G√≥p √ù</span>
            </div>
            <div class="menu-item" onclick="switchView('view-funds', this)">
                <i class="fa-solid fa-hand-holding-dollar"></i> <span>Qu·∫£n l√Ω kho·∫£n thu</span>
            </div>
            <div class="menu-item" onclick="switchView('view-donations', this)">
                <i class="fa-solid fa-hand-holding-heart"></i> <span>Duy·ªát ƒë√≥ng g√≥p</span>
            </div>
            <div class="menu-item" onclick="switchView('view-settings', this)">
                <i class="fa-solid fa-gears"></i> <span>C·∫•u h√¨nh h·ªá th·ªëng</span>
            </div>
            <div class="menu-item" onclick="switchView('view-users', this)">
                <i class="fa-solid fa-users-gear"></i> <span>Qu·∫£n l√Ω th√†nh vi√™n</span>
            </div>

            <li class="nav-separator"></li>
            <li><a href="index.html" target="_blank"><i class="fa-solid fa-external-link-alt"></i> Xem Trang Ch·ªß</a>
            </li>
            <div class="menu-item mt-auto" onclick="logout()">
                <i class="fa-solid fa-right-from-bracket"></i> <span>ƒêƒÉng xu·∫•t</span>
            </div>
        </ul>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <header>
            <div style="display:flex; align-items:center;">
                <button type="button" class="btn-toggle-sidebar" onclick="toggleSidebar()"><i
                        class="fa-solid fa-bars"></i></button>
                <h2 id="page-header" style="margin:0; text-transform: uppercase; letter-spacing: 1px;">TRUNG T√ÇM ƒêI·ªÄU
                    H√ÄNH H·ªÜ TH·ªêNG</h2>
            </div>
            <div class="header-right">
                <!-- Language Switcher Removed to enforce Vietnamese -->
                <span id="admin-welcome" data-i18n="admin_welcome">Ch√†o m·ª´ng, Admin!</span>
                <div class="profile-dropdown" style="position:relative;">
                    <img src="https://ui-avatars.com/api/?name=Admin&background=0056be&color=fff" alt="User"
                        onclick="toggleProfileMenu()" id="header-avatar">
                    <div id="profile-menu" class="dropdown-menu"
                        style="display:none; position:absolute; right:0; top:120%; background:#fff; width:200px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.15); border:1px solid #e2e8f0; overflow:hidden; z-index:1001;">
                        <a href="javascript:void(0)" onclick="openMyProfile()"
                            style="display:block; padding:10px 15px; color:#333; text-decoration:none; border-bottom:1px solid #f1f5f9;"><i
                                class="fa-solid fa-user-circle"></i> H·ªì s∆° c·ªßa t√¥i</a>
                        <a href="javascript:void(0)" onclick="toggleResetUI(); logout();"
                            style="display:block; padding:10px 15px; color:#333; text-decoration:none; border-bottom:1px solid #f1f5f9;"><i
                                class="fa-solid fa-key"></i> ƒê·ªïi m·∫≠t kh·∫©u</a>
                        <a href="javascript:void(0)" onclick="logout()"
                            style="display:block; padding:10px 15px; color:#ef4444; text-decoration:none;"><i
                                class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- VIEW: DASHBOARD -->
        <div id="view-dashboard" class="tab-view active" style="display:block;">
            <div
                style="display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:25px; margin-bottom:30px;">
                <div class="stat-card">
                    <div style="font-size: 40px; opacity: 0.2; position: absolute; right: 20px; bottom: 10px;"><i
                            class="fa-solid fa-newspaper"></i></div>
                    <div class="stat-info">
                        <div class="stat-title">B√†i Vi·∫øt</div>
                        <div class="stat-value" id="stat-articles">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 40px; opacity: 0.2; position: absolute; right: 20px; bottom: 10px;"><i
                            class="fa-solid fa-file-invoice"></i></div>
                    <div class="stat-info">
                        <div class="stat-title">Trang ƒêang Ch·∫°y</div>
                        <div class="stat-value" id="stat-pages">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 40px; opacity: 0.2; position: absolute; right: 20px; bottom: 10px;"><i
                            class="fa-solid fa-chart-line"></i></div>
                    <div class="stat-info">
                        <div class="stat-title">L∆∞·ª£t Truy C·∫≠p</div>
                        <div class="stat-value" id="stat-views">0</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-top:0;">Tin T·ª©c M·ªõi Nh·∫•t</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ti√™u ƒê·ªÅ</th>
                            <th>Ng√†y ƒêƒÉng</th>
                            <th>Chuy√™n M·ª•c</th>
                        </tr>
                    </thead>
                    <tbody id="dashboard-recent-news">
                        <!-- Loaded by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VIEW: ARTICLES -->
        <div id="view-articles" class="tab-view">
            <div class="actions-bar" style="display: flex; gap: 10px; align-items:center; flex-wrap:wrap;">
                <button type="button" class="btn btn-primary" onclick="openEditor()"><i class="fa-solid fa-plus"></i>
                    <span data-i18n="btn_compose">So·∫°n Th·∫£o B√†i Vi·∫øt M·ªõi</span></button>

                <!-- Bulk Actions Toolbar (Hidden by default) -->
                <div id="bulk-actions-toolbar"
                    style="display:none; gap: 10px; margin-left: 20px; padding-left: 20px; border-left: 2px solid #ddd; align-items:center;">
                    <span style="font-weight:bold; color:#555;">ƒêang ch·ªçn: <span id="selected-count"
                            style="color:var(--primary-blue);">0</span></span>

                    <button type="button" class="btn btn-secondary btn-sm" onclick="bulkUpdateDate()"
                        title="C·∫≠p nh·∫≠t ng√†y ƒëƒÉng">
                        <i class="fa-solid fa-calendar"></i> S·ª≠a Ng√†y
                    </button>

                    <button type="button" class="btn btn-info btn-sm" onclick="bulkUpdateStatus()"
                        title="ƒê·ªïi tr·∫°ng th√°i">
                        <i class="fa-solid fa-toggle-on"></i> ƒê·ªïi Tr·∫°ng Th√°i
                    </button>

                    <button type="button" class="btn btn-warning btn-sm" onclick="bulkUpdateCategory()"
                        title="Chuy·ªÉn chuy√™n m·ª•c">
                        <i class="fa-solid fa-folder"></i> Chuy·ªÉn M·ª•c
                    </button>

                    <button type="button" class="btn btn-danger btn-sm" id="btn-bulk-delete"
                        onclick="deleteSelectedArticles()">
                        <i class="fa-solid fa-trash"></i> X√≥a
                    </button>
                </div>
            </div>
            <div class="card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 40px; text-align:center;"><input type="checkbox" id="selectAllArticles"
                                    onchange="toggleSelectAll(this)"></th>
                            <th style="width: 50px;">ID</th>
                            <th style="width: 100px;">Ng√†y ƒêƒÉng</th>
                            <th>Ti√™u ƒê·ªÅ</th>
                            <th style="width: 120px;">Danh M·ª•c</th>
                            <th style="width: 100px;">Tr·∫°ng Th√°i</th>
                            <th style="width: 80px;">Views</th>
                            <th style="width: 100px; text-align:right;">H√†nh ƒê·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="article-list">
                        <!-- Loaded by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VIEW: PAGES -->
        <div id="view-pages" class="tab-view">
            <div class="actions-bar">
                <button type="button" class="btn btn-primary" onclick="openPageEditor()"><i
                        class="fa-solid fa-plus"></i> <span data-i18n="btn_add_page">Th√™m Trang Th√¥ng
                        Tin</span></button>
            </div>
            <div class="card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Slug</th>
                            <th>T√™n Trang</th>
                            <th>Th·ª© T·ª±</th>
                            <th>Menu</th>
                            <th>Ngu·ªìn</th>
                            <th>H√†nh ƒê·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="page-list">
                        <!-- Loaded by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VIEW: FEEDBACK -->
        <div id="view-feedback" class="tab-view">
            <div class="card">
                <h3 style="margin-bottom: 20px;">Danh S√°ch √ù Ki·∫øn / Ph·∫£n √Ånh</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ng√†y G·ª≠i</th>
                            <th>Ng∆∞·ªùi G·ª≠i (Li√™n H·ªá)</th>
                            <th>Ti√™u ƒê·ªÅ</th>
                            <th>N·ªôi Dung</th>
                            <th>Tr·∫°ng Th√°i</th>
                            <th>H√†nh ƒê·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="feedback-list">
                        <tr>
                            <td colspan="6" style="text-align:center;">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VIEW: SETTINGS (Upgraded) -->
        <div id="view-settings" class="tab-view">
            <div class="actions-bar">
                <h3 style="margin:0;">C·∫•u H√¨nh H·ªá Th·ªëng</h3>
                <button type="button" class="btn btn-primary" onclick="saveAllSettings()"><i
                        class="fa-solid fa-save"></i> L∆∞u To√†n B·ªô
                    C·∫•u H√¨nh</button>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <!-- Column 1: General Info -->
                <div class="card">
                    <h4 style="border-bottom:1px solid #eee; padding-bottom:10px; margin-top:0;">Th√¥ng Tin Chung</h4>
                    <div class="form-group">
                        <label>Ti√™u ƒë·ªÅ Website (Title)</label>
                        <input type="text" id="set-website_title" class="form-control" placeholder="T·ªï D√¢n Ph·ªë 21...">
                    </div>
                    <div class="form-group">
                        <label>M√¥ t·∫£ ng·∫Øn (Description)</label>
                        <textarea id="set-website_desc" class="form-control" rows="2"
                            placeholder="Website ch√≠nh th·ª©c..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Logo URL</label>
                        <div style="display:flex; gap:10px;">
                            <input type="text" id="set-logo_url" class="form-control" placeholder="Link ·∫£nh logo...">
                            <button type="button" class="btn btn-secondary"
                                onclick="window.open(document.getElementById('set-logo_url').value)" title="Xem"><i
                                    class="fa-solid fa-eye"></i></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>H√¨nh n·ªÅn Header (Banner)</label>
                        <input type="text" id="set-banner_url" class="form-control"
                            placeholder="Link ·∫£nh banner top...">
                    </div>
                </div>

                <!-- Column 2: Contact Info -->
                <div class="card">
                    <h4 style="border-bottom:1px solid #eee; padding-bottom:10px; margin-top:0;">Th√¥ng Tin Li√™n H·ªá</h4>
                    <div class="form-group">
                        <label>Hotline / SƒêT</label>
                        <input type="text" id="set-hotline" class="form-control" placeholder="098...">
                    </div>
                    <div class="form-group">
                        <label>Email Li√™n H·ªá</label>
                        <input type="text" id="set-email" class="form-control" placeholder="contact@example.com">
                    </div>
                    <div class="form-group">
                        <label>ƒê·ªãa Ch·ªâ</label>
                        <input type="text" id="set-address" class="form-control" placeholder="S·ªë nh√†, ƒë∆∞·ªùng...">
                    </div>
                    <div class="form-group">
                        <label>Link Facebook Fanpage</label>
                        <input type="text" id="set-facebook" class="form-control"
                            placeholder="https://facebook.com/...">
                    </div>
                    <div class="form-group">
                        <label>Link Youtube</label>
                        <input type="text" id="set-youtube" class="form-control" placeholder="https://youtube.com/...">
                    </div>
                </div>
            </div>

            <!-- Advanced / System Tools -->
            <div class="card" style="margin-top:20px;">
                <h4 style="border-bottom:1px solid #eee; padding-bottom:10px; margin-top:0;">N√¢ng Cao & C√¥ng C·ª•</h4>

                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div style="width: 48%;">
                        <div class="form-group">
                            <label>D√≤ng th√¥ng b√°o ch·∫°y (Marquee)</label>
                            <textarea id="set-marquee" class="form-control" rows="3"
                                placeholder="Th√¥ng b√°o: ..."></textarea>
                        </div>
                    </div>
                    <div style="width: 48%;">
                        <label>C√¥ng c·ª• h·ªá th·ªëng</label>
                        <div style="background:#f9f9f9; padding:15px; border-radius:5px;">
                            <button type="button" class="btn btn-secondary" onclick="window.testFirebaseConnection()"><i
                                    class="fa-solid fa-network-wired"></i> Ki·ªÉm Tra K·∫øt N·ªëi Firebase</button>
                            <button type="button" class="btn btn-danger"
                                onclick="if(confirm('X√≥a Cache s·∫Ω t·∫£i l·∫°i d·ªØ li·ªáu m·ªõi nh·∫•t. Ti·∫øp t·ª•c?')) { localStorage.clear(); location.reload(); }"
                                style="margin-left:10px;"><i class="fa-solid fa-sync"></i> X√≥a Cache & Reload</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: EDITOR (V3 - Redesigned) -->
        <div id="view-editor" class="tab-view" style="padding: 0;">
            <!-- Sticky Header -->
            <div class="sticky-bar">
                <div style="display:flex; align-items:center; gap:10px;">
                    <a href="javascript:void(0)" onclick="closeEditor()" style="color:#666; font-size:18px;"><i
                            class="fa-solid fa-arrow-left"></i></a>
                    <h3 style="margin:0;" id="editor-heading">So·∫°n Th·∫£o B√†i Vi·∫øt</h3>
                </div>
                <div style="display:flex; gap:10px;">
                    <button type="button" class="btn btn-outline-primary" onclick="insertGooglePhotoToBody()"
                        title="Ch√®n ·∫£nh Google Photos v√†o b√†i vi·∫øt"><i class="fa-brands fa-google"></i> Ch√®n
                        ·∫¢nh</button>
                    <button type="button" class="btn btn-info" onclick="autoTranslate()"
                        title="D·ªãch t·ª± ƒë·ªông sang Ti·∫øng Anh chu·∫©n"><i class="fa-solid fa-language"></i> D·ªãch & Chu·∫©n
                        H√≥a</button>
                    <button type="button" class="btn btn-secondary" onclick="previewArticle()"><i
                            class="fa-solid fa-eye"></i> Xem
                        Tr∆∞·ªõc</button>
                    <button type="button" class="btn btn-success" onclick="saveArticle()"><i
                            class="fa-solid fa-save"></i> ƒêƒÉng
                        B√†i</button>
                </div>
            </div>

            <div class="editor-wrapper">
                <!-- MAIN CONTENT (Left) - 75% -->
                <div class="editor-main">
                    <!-- LANGUAGE TABS -->
                    <div class="editor-tabs"
                        style="margin-bottom: 15px; border-bottom: 2px solid #eee; display: flex; gap: 20px;">
                        <div class="tab-item active" onclick="switchEditorLang('vn', this)"
                            style="padding: 10px; cursor: pointer; border-bottom: 2px solid var(--primary-red); font-weight: bold;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Flag_of_Vietnam.svg/20px-Flag_of_Vietnam.svg.png"
                                style="vertical-align: middle;"> Ti·∫øng Vi·ªát
                        </div>
                        <div class="tab-item" onclick="switchEditorLang('en', this)"
                            style="padding: 10px; cursor: pointer; color: #888;">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Flag_of_the_United_States.svg/20px-Flag_of_the_United_States.svg.png"
                                style="vertical-align: middle;"> Ti·∫øng Anh (English)
                        </div>
                    </div>

                    <!-- VIETNAMESE FIELDS -->
                    <div id="editor-vn">
                        <!-- Title & Slug -->
                        <div style="margin-bottom: 20px;">
                            <input type="text" id="art-title" class="input-title"
                                placeholder="NH·∫¨P TI√äU ƒê·ªÄ B√ÄI VI·∫æT (VI) T·∫†I ƒê√ÇY..." onkeyup="generateSlug()"
                                autocomplete="off">
                            <div style="margin-top:8px; display:flex; align-items:center; gap:5px;">
                                <span style="font-size:13px; color:#999;"><i class="fa-solid fa-link"></i> Link:</span>
                                <div
                                    style="background:#f0f2f5; padding:4px 8px; border-radius:4px; font-size:13px; color:#555; flex:1;">
                                    <span style="color:#888;">https://todanpho21.vn/bai-viet/</span>
                                    <input type="text" id="art-slug" class="input-slug" placeholder="tie-de-bai-viet"
                                        readonly ondblclick="this.readOnly=false"
                                        style="background:transparent; border:none; width:auto; min-width:300px; color:#333; font-weight:500;">
                                </div>
                            </div>
                        </div>

                        <!-- Excerpt/Summary (Moved Up) -->
                        <div class="form-group">
                            <label style="font-weight:600; text-transform:uppercase; font-size:12px; color:#666;">M√¥ t·∫£
                                ng·∫Øn
                                (Sapo)</label>
                            <textarea id="art-summary" class="form-control" rows="3"
                                placeholder="T√≥m t·∫Øt n·ªôi dung ch√≠nh c·ªßa b√†i vi·∫øt (Hi·ªÉn th·ªã ƒë·∫ßu b√†i v√† tr√™n danh s√°ch tin)..."
                                style="font-size:15px; line-height:1.5;"></textarea>
                        </div>

                        <!-- Editor -->
                        <div
                            style="flex:1; display:flex; flex-direction:column; min-height: 500px; border:1px solid #ddd; border-top:3px solid var(--primary-blue); border-radius:4px;">
                            <textarea id="art-editor"></textarea>
                        </div>
                    </div>

                    <!-- ENGLISH FIELDS (Initially Hidden) -->
                    <div id="editor-en" style="display: none;">
                        <div style="margin-bottom: 20px;">
                            <input type="text" id="art-title-en" class="input-title"
                                placeholder="ENTER ARTICLE TITLE (EN) HERE..." autocomplete="off">
                        </div>

                        <div class="form-group">
                            <label style="font-weight:600; text-transform:uppercase; font-size:12px; color:#666;">Short
                                Description (Sapo EN)</label>
                            <textarea id="art-summary-en" class="form-control" rows="3"
                                placeholder="Short summary of the article..."
                                style="font-size:15px; line-height:1.5;"></textarea>
                        </div>

                        <div
                            style="flex:1; display:flex; flex-direction:column; min-height: 500px; border:1px solid #ddd; border-top:3px solid var(--primary-blue); border-radius:4px;">
                            <textarea id="art-editor-en"></textarea>
                        </div>
                    </div>
                </div>

                <!-- SIDEBAR (Right) - 25% -->
                <div class="editor-sidebar">

                    <!-- Section: Google Docs Import -->
                    <div class="sidebar-section" style="border: 2px dashed #4285F4; background: #f8fbff;">
                        <h4 class="section-title" style="color:#d93025;"><i class="fa-brands fa-google-drive"></i> Nh·∫≠p
                            t·ª´ Google Docs</h4>
                        <div class="form-group">
                            <label style="font-size:12px;">D√°n Link (Ch·∫ø ƒë·ªô: Publish to web)</label>
                            <input type="text" id="gdoc-url" class="form-control"
                                placeholder="https://docs.google.com/document/d/.../pub">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="importGoogleDoc()" style="width:100%;">
                            <i class="fa-solid fa-cloud-download-alt"></i> T·∫£i N·ªôi Dung Ngay
                        </button>
                        <small style="display:block; margin-top:5px; color:#666; font-size:11px;">
                            * L∆∞u √Ω: H√£y d√πng link <b>"File -> Share -> Publish to web"</b> ƒë·ªÉ c√≥ k·∫øt qu·∫£ t·ªët nh·∫•t.
                        </small>
                    </div>

                    <!-- Section: Publish -->
                    <div class="sidebar-section">
                        <h4 class="section-title"><i class="fa-solid fa-globe"></i> ƒêƒÉng T·∫£i</h4>
                        <div class="form-group">
                            <label>Tr·∫°ng Th√°i</label>
                            <select id="art-status" class="form-control">
                                <option value="Published">C√¥ng Khai (Hi·ªÉn th·ªã ngay)</option>
                                <option value="Draft">B·∫£n Nh√°p (L∆∞u t·∫°m)</option>
                                <option value="Private">Ri√™ng T∆∞ (Ch·ªâ Admin xem)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ng√†y ƒêƒÉng</label>
                            <input type="date" id="art-date" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>T√°c Gi·∫£</label>
                            <input type="text" id="art-author" class="form-control" placeholder="T√™n ng∆∞·ªùi vi·∫øt...">
                        </div>
                        <div class="form-group">
                            <label
                                style="display:flex; align-items:center; cursor:pointer; background:#f9f9f9; padding:8px; border-radius:4px;">
                                <input type="checkbox" id="art-featured" style="margin-right:10px;"> ƒê·∫∑t l√†m Tin N·ªïi B·∫≠t
                            </label>
                        </div>
                    </div>

                    <!-- Section: Category -->
                    <div class="sidebar-section">
                        <h4 class="section-title"><i class="fa-solid fa-folder"></i> Ph√¢n Lo·∫°i</h4>
                        <div class="form-group">
                            <label>Chuy√™n M·ª•c <span class="required">*</span></label>
                            <select id="art-category" class="form-control" size="8" style="height:auto;">
                                <option value="TRANG_CHU">üì∞ Tin T·ª©c & S·ª± Ki·ªán Chung</option>
                                <option value="THONG_BAO">üì¢ Th√¥ng B√°o Quan Tr·ªçng (Ch·∫°y ch·ªØ)</option>
                                <option value="CB">‚ò≠ Chi B·ªô ƒêCS</option>
                                <option value="MT">üö© M·∫∑t Tr·∫≠n T·ªï Qu·ªëc</option>
                                <option value="PHU_NU">üå∏ H·ªôi Li√™n Hi·ªáp Ph·ª• N·ªØ</option>
                                <option value="CCB">üéñÔ∏è H·ªôi C·ª±u Chi·∫øn Binh</option>
                                <option value="TN">üëï ƒêo√†n Thanh Ni√™n</option>
                                <option value="NCT">üë¥ H·ªôi Ng∆∞·ªùi Cao Tu·ªïi</option>
                                <option value="KH">üìö Ban Khuy·∫øn H·ªçc</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Th·∫ª (Tags)</label>
                            <input type="text" id="art-tags" class="form-control"
                                placeholder="VD: ngh·ªã quy·∫øt, ƒë·∫°i h·ªôi...">
                        </div>
                    </div>

                    <!-- Section: Image -->
                    <div class="sidebar-section">
                        <h4 class="section-title"><i class="fa-solid fa-image"></i> ·∫¢nh ƒê·∫°i Di·ªán</h4>
                        <div class="image-upload-box" onclick="triggerImageUpload()" style="height: 180px;">
                            <div id="upload-placeholder">
                                <i class="fa-solid fa-cloud-upload-alt"></i>
                                <div>Ch·ªçn ·∫£nh t·ª´ m√°y</div>
                            </div>
                            <img id="art-img-preview" class="image-upload-preview">
                            <div class="remove-img-btn" onclick="removeImage(event)">&times;</div>
                        </div>
                        <div style="margin-top:10px; display:flex; gap:5px; align-items:center;">
                            <input type="text" id="art-image" class="form-control form-control-sm"
                                placeholder="D√°n URL ·∫£nh..." style="font-size:12px;"
                                onchange="previewImageFromUrl(this.value)">
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="pasteGooglePhoto()"
                                title="H·ªó tr·ª£ Google Photos" style="white-space:nowrap;">
                                <i class="fa-brands fa-google"></i> Photos
                            </button>
                        </div>
                    </div>

                    <!-- Section: Media & SEO -->
                    <div class="sidebar-section">
                        <h4 class="section-title"><i class="fa-solid fa-paperclip"></i> Media & SEO</h4>
                        <div class="form-group">
                            <label>Video (Youtube Link)</label>
                            <input type="text" id="art-video" class="form-control"
                                placeholder="https://youtube.com/...">
                        </div>
                        <div class="form-group">
                            <label>File ƒê√≠nh K√®m</label>
                            <input type="text" id="art-attachments" class="form-control">
                        </div>
                        <div style="border-top:1px dashed #ddd; margin:10px 0;"></div>
                        <div class="form-group">
                            <label>SEO Title</label>
                            <input type="text" id="art-seo-title" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>SEO Description</label>
                            <textarea id="art-seo-desc" class="form-control" rows="2"></textarea>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- VIEW: PAGE EDITOR -->
        <div id="view-page-editor" class="tab-view">
            <div class="actions-bar">
                <h3 style="margin:0;" id="page-editor-heading">C·∫•u H√¨nh Trang</h3>
                <div>
                    <button type="button" class="btn btn-secondary" onclick="closePageEditor()">H·ªßy B·ªè</button>
                    <button type="button" class="btn btn-success" onclick="savePage()"><i class="fa-solid fa-save"></i>
                        L∆∞u
                        Trang</button>
                </div>
            </div>
            <div style="display:flex; gap:20px;">
                <div style="flex:2; background:white; padding:20px; border-radius:5px;">
                    <div class="form-group">
                        <label>Ti√™u ƒê·ªÅ Trang <span class="required">*</span></label>
                        <input type="text" id="page-title" class="form-control">
                    </div>
                    <textarea id="page-editor"></textarea>
                </div>
                <div style="flex:1; display:flex; flex-direction:column; gap:15px;">
                    <div class="card">
                        <div class="form-group">
                            <label>ƒê∆∞·ªùng d·∫´n (Slug) <span class="required">*</span></label>
                            <input type="text" id="page-slug" class="form-control" placeholder="gioi-thieu">
                        </div>
                        <div class="form-group">
                            <label>Th·ª© t·ª± hi·ªÉn th·ªã</label>
                            <input type="number" id="page-order" class="form-control" value="99">
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="page-menu" checked> Hi·ªÉn th·ªã tr√™n Menu</label>
                        </div>
                    </div>
                    <div class="card">
                        <div class="form-group">
                            <label>Banner ·∫¢nh (URL)</label>
                            <input type="text" id="page-banner" class="form-control">
                            <img id="page-banner-preview" src="" style="width:100%; margin-top:5px; display:none;">
                        </div>
                        <div class="form-group">
                            <label>Link VƒÉn B·∫£n G·ªëc (n·∫øu c√≥)</label>
                            <input type="text" id="page-doc" class="form-control">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: DONATIONS MANAGEMENT -->
        <!-- VIEW: DONATIONS MANAGEMENT (Drill-down Redesign) -->
        <div id="view-donations" class="tab-view">

            <!-- MODE 1: SELECT FUND -->
            <div id="donations-fund-list">
                <div class="actions-bar">
                    <h3 style="margin:0;"><i class="fa-solid fa-circle-check" style="color:var(--primary-blue);"></i>
                        Duy·ªát ƒê√≥ng G√≥p - Ch·ªçn Qu·ªπ</h3>
                    <button type="button" class="btn btn-secondary" onclick="loadDonationFundsMode()"><i
                            class="fa-solid fa-rotate"></i> L√†m m·ªõi</button>
                </div>

                <style>
                    .fund-select-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                        gap: 20px;
                    }

                    .fund-select-card {
                        background: white;
                        border-radius: 12px;
                        padding: 20px;
                        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                        border: 1px solid #e2e8f0;
                        cursor: pointer;
                        transition: all 0.2s;
                        position: relative;
                        overflow: hidden;
                    }

                    .fund-select-card:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
                        border-color: var(--primary-blue);
                    }

                    .fund-select-card::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 4px;
                        height: 100%;
                        background: var(--primary-blue);
                        opacity: 0.5;
                    }

                    .f-card-title {
                        font-weight: 700;
                        font-size: 16px;
                        margin-bottom: 5px;
                        color: #1e293b;
                    }

                    .f-card-stats {
                        font-size: 13px;
                        color: #64748b;
                        display: flex;
                        justify-content: space-between;
                        margin-top: 15px;
                        padding-top: 10px;
                        border-top: 1px dashed #e2e8f0;
                    }
                </style>

                <div id="admin-fund-grid" class="fund-select-grid">
                    <!-- Loaded by JS -->
                    <div class="fund-select-card">
                        <div class="f-card-title">ƒêang t·∫£i danh s√°ch qu·ªπ...</div>
                    </div>
                </div>
            </div>

            <!-- MODE 2: DETAIL LIST -->
            <div id="donations-detail-list" style="display:none;">
                <div class="actions-bar">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <button class="btn btn-secondary" onclick="backToFundList()" title="Quay l·∫°i"><i
                                class="fa-solid fa-arrow-left"></i></button>
                        <div>
                            <h3 style="margin:0;" id="detail-fund-name">Chi Ti·∫øt ƒê√≥ng G√≥p</h3>
                            <small style="color:#666;" id="detail-fund-desc">---</small>
                        </div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button type="button" class="btn btn-info" onclick="exportDonationsToCSV()"><i
                                class="fa-solid fa-file-csv"></i> Xu·∫•t Excel (CSV)</button>
                        <button type="button" class="btn btn-primary" onclick="openManualDonationModal()"><i
                                class="fa-solid fa-plus-circle"></i> Nh·∫≠p Thu C√¥ng</button>
                        <button type="button" class="btn btn-secondary" onclick="refreshCurrentDonationList()"><i
                                class="fa-solid fa-rotate"></i> T·∫£i l·∫°i</button>
                    </div>
                </div>

                <!-- Bulk Actions Toolbar for Donations -->
                <div id="bulk-donation-actions-toolbar"
                    style="display:none; gap: 10px; margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0; align-items:center; animation: slideDown 0.3s ease;">
                    <span style="font-weight:bold; color:#1e293b; margin-right: 10px;">
                        <i class="fa-solid fa-check-double" style="color:var(--primary-blue);"></i> ƒêang ch·ªçn:
                        <span id="selected-donation-count" style="color:var(--primary-red); font-size: 16px;">0</span>
                    </span>

                    <button type="button" class="btn btn-success btn-sm" onclick="bulkVerifyDonations()">
                        <i class="fa-solid fa-check"></i> Duy·ªát h√†ng lo·∫°t
                    </button>

                    <button type="button" class="btn btn-danger btn-sm" onclick="bulkDeleteDonations()">
                        <i class="fa-solid fa-trash"></i> X√≥a h√†ng lo·∫°t
                    </button>

                    <button type="button" class="btn btn-secondary btn-sm" onclick="clearDonationSelection()"
                        style="margin-left: auto;">
                        B·ªè ch·ªçn
                    </button>
                </div>

                <div class="card">
                    <div
                        style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center; justify-content: space-between;">
                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                            <div class="status-filters">
                                <button class="btn btn-sm btn-primary" onclick="setDonationStatusFilter('all')">T·∫•t
                                    c·∫£</button>
                                <button class="btn btn-sm btn-warning" onclick="setDonationStatusFilter('pending')">Ch·ªù
                                    duy·ªát</button>
                                <button class="btn btn-sm btn-success" onclick="setDonationStatusFilter('verified')">ƒê√£
                                    duy·ªát</button>
                            </div>
                            <!-- Advanced Filters -->
                            <select id="filter-payment-method" class="form-control form-control-sm" style="width:130px;"
                                onchange="fetchFundDonations()">
                                <option value="all">M·ªçi ngu·ªìn</option>
                                <option value="momo">MoMo</option>
                                <option value="bank">Chuy·ªÉn kho·∫£n</option>
                                <option value="cash">Ti·ªÅn m·∫∑t</option>
                            </select>
                            <input type="date" id="filter-date-start" class="form-control form-control-sm"
                                style="width:140px;" onchange="fetchFundDonations()" title="T·ª´ ng√†y">
                            <input type="date" id="filter-date-end" class="form-control form-control-sm"
                                style="width:140px;" onchange="fetchFundDonations()" title="ƒê·∫øn ng√†y">
                        </div>
                        <input type="text" id="admin-donation-search" class="form-control" style="width: 250px;"
                            placeholder="üîç T√¨m m√£/t√™n/s·ªë ti·ªÅn..." onkeyup="filterAdminDonations()">
                    </div>

                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width:40px;"><input type="checkbox" id="selectAllDonations"
                                            onchange="toggleSelectAllDonations(this)"></th>
                                    <th>Th·ªùi gian</th>
                                    <th>M√£ GD</th>
                                    <th>Th√¥ng tin ng∆∞·ªùi n·ªôp</th>
                                    <th>S·ªë ti·ªÅn</th>
                                    <th>L∆∞u √Ω c√¥ng khai</th>
                                    <th>T.Tr·∫°ng</th>
                                    <th>H√†nh ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody id="donation-list">
                                <!-- Loaded via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="donation-pagination" class="pagination-container"></div>
            </div>

        </div>

        <!-- VIEW: USER MANAGEMENT -->
        <div id="view-users" class="tab-view">
            <div class="actions-bar">
                <h3 style="margin:0;"><i class="fa-solid fa-users-gear" style="color:var(--primary-blue);"></i> Qu·∫£n L√Ω
                    Th√†nh Vi√™n</h3>
                <button type="button" class="btn btn-primary" onclick="openUserModal()"><i
                        class="fa-solid fa-user-plus"></i> Th√™m Th√†nh Vi√™n</button>
            </div>

            <div class="card">
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>H·ªç v√† T√™n</th>
                                <th>Email (T√†i kho·∫£n)</th>
                                <th>Ch·ª©c V·ª•</th>
                                <th>Tr·∫°ng Th√°i</th>
                                <th>H√†nh ƒê·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="user-list">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- USER MODAL -->
        <div id="user-modal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <h3 id="user-modal-title" style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">Th√™m
                    Th√†nh Vi√™n</h3>
                <div class="form-group">
                    <label>H·ªç v√† T√™n <span class="required">*</span></label>
                    <input type="text" id="u-name" class="form-control" placeholder="Nguy·ªÖn VƒÉn A">
                </div>
                <div class="form-group">
                    <label>Email (ƒêƒÉng nh·∫≠p) <span class="required">*</span></label>
                    <input type="email" id="u-email" class="form-control" placeholder="email@example.com">
                    <small style="color:#666;">* User c·∫ßn d√πng Email n√†y ƒë·ªÉ t·∫°o t√†i kho·∫£n/ƒëƒÉng nh·∫≠p.</small>
                </div>
                <div class="form-group">
                    <label>Ch·ª©c V·ª• / Vai Tr√≤</label>
                    <select id="u-role" class="form-control">
                        <option value="admin">Qu·∫£n Tr·ªã Vi√™n (To√†n quy·ªÅn)</option>
                        <option value="moderator">C√°n B·ªô X√°c Minh (Duy·ªát ƒë√≥ng g√≥p & H·ªôp th∆∞)</option>
                        <option value="editor">Ban Bi√™n T·∫≠p (Qu·∫£n l√Ω tin b√†i & Trang)</option>
                    </select>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div class="form-group">
                        <label>S·ªë ƒêi·ªán Tho·∫°i</label>
                        <input type="text" id="u-phone" class="form-control" placeholder="098...">
                    </div>
                    <div class="form-group">
                        <label>Link Avatar (·∫¢nh)</label>
                        <input type="text" id="u-avatar" class="form-control" placeholder="https://...">
                    </div>
                </div>

                <div class="form-group">
                    <label>M·∫≠t Kh·∫©u / B·∫£o M·∫≠t</label>
                    <button type="button" class="btn btn-warning" onclick="sendPasswordResetForUser()"
                        style="width:100%; font-size:13px;">
                        <i class="fa-solid fa-envelope"></i> G·ª≠i Email ƒê·∫∑t L·∫°i M·∫≠t Kh·∫©u
                    </button>
                    <small style="display:block; margin-top:5px; color:#666;">* H·ªá th·ªëng s·∫Ω g·ª≠i link ƒë·ªïi m·∫≠t kh·∫©u cho
                        User n√†y.</small>
                </div>

                <div class="form-group">
                    <label><input type="checkbox" id="u-active" checked> K√≠ch ho·∫°t t√†i kho·∫£n</label>
                </div>

                <div style="text-align:right; margin-top:20px;">
                    <button class="btn btn-secondary" onclick="closeUserModal()">H·ªßy</button>
                    <button class="btn btn-success" onclick="saveUser()">L∆∞u L·∫°i</button>
                </div>
            </div>
        </div>

        <!-- VIEW: FUNDS MANAGEMENT -->
        <div id="view-funds" class="tab-view">
            <div class="actions-bar" style="display:flex; gap:10px;">
                <button type="button" class="btn btn-primary" onclick="openFundModal()"><i class="fa-solid fa-plus"></i>
                    Th√™m Kho·∫£n Thu M·ªõi</button>
                <button type="button" class="btn btn-warning" onclick="syncAllFundsStats()"
                    title="T√≠nh to√°n l·∫°i to√†n b·ªô s·ªë ti·ªÅn & l∆∞·ª£t ƒë√≥ng g√≥p t·ª´ danh s√°ch th·ª±c t·∫ø">
                    <i class="fa-solid fa-arrows-rotate"></i> L√†m m·ªõi to√†n b·ªô s·ªë li·ªáu
                </button>
            </div>
            <div class="card">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>T√™n Kho·∫£n Thu/Qu·ªπ</th>
                            <th>Ph√¢n Lo·∫°i (ƒê∆°n v·ªã)</th>
                            <th>M√£ T√™n Qu·ªπ</th>
                            <th>Tr·∫°ng Th√°i</th>
                            <th>H√†nh ƒê·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="fund-list"></tbody>
                </table>
            </div>

            <!-- FUND MODAL -->
            <div id="fund-modal" class="modal-overlay" style="display:none;">
                <div class="modal-box modal-large">
                    <div class="login-glass" style="padding:0; text-align:left; max-width: 100%;">
                        <h3
                            style="margin-top:0; color:var(--primary-red); border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 25px;">
                            <i class="fa-solid fa-hand-holding-dollar"></i> C·∫•u H√¨nh Kho·∫£n Thu / Qu·ªπ V·∫≠n ƒê·ªông
                        </h3>
                        <input type="hidden" id="fund-id">

                        <div class="modal-grid">
                            <!-- LEFT COLUMN: Main Content -->
                            <div class="modal-column">
                                <div class="form-group">
                                    <label>T√™n Qu·ªπ / Kho·∫£n Thu <span class="required"
                                            style="color:red;">*</span></label>
                                    <input type="text" id="fund-title" class="form-control"
                                        placeholder="VD: Qu·ªπ V√¨ Ng∆∞·ªùi Ngh√®o 2024">
                                </div>

                                <div class="form-group">
                                    <label>M√¥ t·∫£ ng·∫Øn (Hi·ªÉn th·ªã ·ªü danh s√°ch)</label>
                                    <textarea id="fund-summary" class="form-control" rows="2"
                                        placeholder="T√≥m t·∫Øt v·ªã cu·ªôc v·∫≠n ƒë·ªông n√†y..."></textarea>
                                </div>

                                <div class="form-group">
                                    <label>N·ªôi dung chi ti·∫øt (B√†i vi·∫øt v·∫≠n ƒë·ªông)</label>
                                    <textarea id="fund-editor" class="form-control" style="height: 350px;"></textarea>
                                </div>
                            </div>

                            <!-- RIGHT COLUMN: Settings & Banking -->
                            <div class="modal-column">
                                <div class="modal-column-right">
                                    <div class="form-group">
                                        <label>Hi·ªÉn th·ªã t·∫°i trang (ƒê∆°n v·ªã) <span class="required"
                                                style="color:red;">*</span></label>
                                        <select id="fund-category" class="form-control">
                                            <option value="ALL">T·∫•t c·∫£ (Trang ch·ªß)</option>
                                            <option value="MT">M·∫∑t Tr·∫≠n T·ªï Qu·ªëc</option>
                                            <option value="KH">Ban Khuy·∫øn H·ªçc</option>
                                            <option value="TN">ƒêo√†n Thanh Ni√™n</option>
                                            <option value="PHU_NU">H·ªôi Ph·ª• N·ªØ</option>
                                            <option value="CCB">H·ªôi C·ª±u Chi·∫øn Binh</option>
                                            <option value="NCT">H·ªôi Ng∆∞·ªùi Cao Tu·ªïi</option>
                                            <option value="CB">Chi B·ªô</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label>Lo·∫°i H√¨nh Qu·ªπ / Kho·∫£n Thu <span class="required"
                                                style="color:red;">*</span></label>
                                        <select id="fund-type" class="form-control">
                                            <option value="DONATION">‚ù§Ô∏è ƒê√≥ng g√≥p t·ª± nguy·ªán (M·∫∑c ƒë·ªãnh)</option>
                                            <option value="BUDGET">üí∞ Thu ng√¢n s√°ch / B·∫Øt bu·ªôc</option>
                                        </select>
                                    </div>

                                    <div
                                        style="padding: 15px; background: white; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 15px;">
                                        <h5
                                            style="margin: 0 0 15px 0; font-size: 14px; color: var(--primary-red); border-bottom: 1px solid #eee; padding-bottom: 8px;">
                                            C·∫§U H√åNH CHI TI·∫æT</h5>

                                        <div class="form-group">
                                            <label>M·ª•c ti√™u (S·ªë ti·ªÅn c·∫ßn thu)</label>
                                            <input type="number" id="fund-target" class="form-control"
                                                placeholder="0 (Kh√¥ng gi·ªõi h·∫°n)">
                                        </div>

                                        <div class="form-group">
                                            <label>·∫¢nh ƒë·∫°i di·ªán / Banner (URL)</label>
                                            <input type="text" id="fund-image" class="form-control"
                                                placeholder="https://..."
                                                onchange="document.getElementById('fund-img-preview').src = this.value || ''">
                                            <img id="fund-img-preview" src=""
                                                style="width: 100%; height: auto; margin-top: 5px; border-radius: 4px; display: block; min-height: 10px; background: #f9f9f9;">
                                        </div>

                                        <div class="form-group">
                                            <label>M√£ T√™n Qu·ªπ (D√πng cho n·ªôi dung CK)</label>
                                            <input type="text" id="fund-code" class="form-control"
                                                placeholder="VD: QUYNGUOINGHEO"
                                                oninput="this.value = this.value.toUpperCase().replace(/\s/g, '')">
                                            <small style="color:#666; font-size: 11px;">M√£ n√†y s·∫Ω ƒë∆∞·ª£c d√πng trong c√∫
                                                ph√°p chuy·ªÉn kho·∫£n: UH [M√£ Giao D·ªãch] [T√™n Qu·ªπ]</small>
                                        </div>

                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label>C√∫ ph√°p n·ªôi dung m·∫´u (G·ª£i √Ω)</label>
                                            <input type="text" id="fund-template" class="form-control"
                                                placeholder="TDP21 UNGHONGHEO">
                                        </div>
                                    </div>

                                    <div class="form-group"
                                        style="background: #fff5f5; padding: 10px; border-radius: 8px;">
                                        <label
                                            style="margin-bottom: 0; display: flex; align-items: center; gap: 8px; color: #b91c1c;">
                                            <input type="checkbox" id="fund-active" checked
                                                style="width: 18px; height: 18px;">
                                            ƒêang k√≠ch ho·∫°t (Cho ph√©p ƒë√≥ng g√≥p)
                                        </label>
                                    </div>
                                </div>

                                <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:10px;">
                                    <button type="button" class="btn btn-secondary"
                                        style="height: 45px; padding: 0 25px;"
                                        onclick="document.getElementById('fund-modal').style.display='none'">H·ªßy</button>
                                    <button type="button" class="btn btn-success"
                                        style="height: 45px; padding: 0 35px; font-weight: 800;"
                                        onclick="saveFund()">L∆∞u L·∫°i</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- MANUAL DONATION MODAL -->
        <div id="manual-donation-modal" class="modal">
            <div class="modal-content" style="max-width: 550px;">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;"><i
                        class="fa-solid fa-plus-circle"></i> Nh·∫≠p ƒê√≥ng G√≥p Th·ªß C√¥ng</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div class="form-group">
                        <label>H·ªç T√™n <span class="required">*</span></label>
                        <input type="text" id="m-don-name" class="form-control" placeholder="Nguy·ªÖn VƒÉn A">
                    </div>
                    <div class="form-group">
                        <label>S·ªë Ti·ªÅn (VNƒê) <span class="required">*</span></label>
                        <input type="number" id="m-don-amount" class="form-control" placeholder="100000">
                    </div>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div class="form-group">
                        <label>Ng√†y Nh·∫≠n</label>
                        <input type="date" id="m-don-date" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Ph∆∞∆°ng th·ª©c</label>
                        <select id="m-don-method" class="form-control">
                            <option value="cash">Ti·ªÅn m·∫∑t</option>
                            <option value="bank">Chuy·ªÉn kho·∫£n tr·ª±c ti·∫øp</option>
                            <option value="momo">MoMo (Th·ªß c√¥ng)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>N·ªôi dung / L·ªùi nh·∫Øn</label>
                    <textarea id="m-don-msg" class="form-control" rows="2"
                        placeholder="V√≠ d·ª•: ·ª¶ng h·ªô b√£o l·ª•t..."></textarea>
                </div>
                <div class="form-group">
                    <label style="color:var(--primary-blue);">Ghi ch√∫ c√¥ng khai (Ph·∫£n h·ªìi t·ª´ Admin)</label>
                    <input type="text" id="m-don-note" class="form-control"
                        placeholder="V√≠ d·ª•: ƒê√£ nh·∫≠n ti·ªÅn m·∫∑t t·∫°i nh√† vƒÉn h√≥a.">
                    <small style="color:#666;">* Ghi ch√∫ n√†y s·∫Ω hi·ªÉn th·ªã c√¥ng khai cho m·ªçi ng∆∞·ªùi xem.</small>
                </div>
                <div style="text-align:right; margin-top:20px; gap:10px; display:flex; justify-content:flex-end;">
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('manual-donation-modal')">H·ªßy</button>
                    <button type="button" class="btn btn-success" onclick="saveManualDonation()">L∆∞u B·∫£n Ghi</button>
                </div>
            </div>
        </div>

        <!-- EDIT DONATION MODAL -->
        <div id="edit-donation-modal" class="modal">
            <div class="modal-content" style="max-width: 550px;">
                <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;"><i
                        class="fa-solid fa-edit"></i> Ch·ªânh S·ª≠a & Ghi Ch√∫ C√¥ng Khai</h3>
                <input type="hidden" id="edit-don-id">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div class="form-group">
                        <label>H·ªç T√™n</label>
                        <input type="text" id="edit-don-name" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>S·ªë Ti·ªÅn</label>
                        <input type="number" id="edit-don-amount" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label>L·ªùi nh·∫Øn c·ªßa ng∆∞·ªùi d√¢n</label>
                    <textarea id="edit-don-msg" class="form-control" rows="2" readonly
                        style="background:#f1f5f9; cursor:not-allowed;"></textarea>
                </div>
                <div class="form-group">
                    <label style="color:var(--primary-blue);">Ghi ch√∫ c√¥ng khai (Admin ph·∫£n h·ªìi)</label>
                    <textarea id="edit-don-note" class="form-control" rows="3"
                        placeholder="Ph·∫£n h·ªìi l·∫°i cho ng∆∞·ªùi d√¢n th·∫•y..."></textarea>
                    <small style="color:#666;">* V√≠ d·ª•: "ƒê√£ nh·∫≠n ƒë∆∞·ª£c ti·ªÅn, c·∫£m ∆°n gia ƒë√¨nh b√°c!", "Ti·ªÅn ƒë√£ ƒë∆∞·ª£c chuy·ªÉn
                        v√†o qu·ªπ khuy·∫øn h·ªçc".</small>
                </div>
                <div style="text-align:right; margin-top:20px; gap:10px; display:flex; justify-content:flex-end;">
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('edit-donation-modal')">ƒê√≥ng</button>
                    <button type="button" class="btn btn-primary" onclick="updateDonationDetail()">C·∫≠p Nh·∫≠t Thay
                        ƒê·ªïi</button>
                </div>
            </div>
        </div>

        <!-- UTILS: Toast Container -->
        <div id="toast-container"></div>

        <!-- App Logic -->
        <script src="lang.js?v=20260112_FIX_EMAIL"></script>
        <script src="admin.js?v=AUTHOR_FIX_V1"></script>

        <!-- EMERGENCY LOGIN FIX (INLINE TO BYPASS CACHE) -->
        <script>
            // Override the external function immediately
            async function attemptLogin() {
                let emailInput = document.getElementById('login-input');
                let passInput = document.getElementById('login-pass');
                let msg = document.getElementById('login-msg');

                let email = emailInput.value;
                let pass = passInput.value;

                // 1. VISUAL DEBUGGING
                console.log("Original Email:", email);

                // 2. AGGRESSIVE CLEANING (Whitelist)
                // Remove anything that is NOT a letter, number, @, dot, underscore, or dash
                let cleanEmail = email.replace(/[^a-zA-Z0-9@._-]/g, '');

                // 3. UPDATE INPUT & LOG
                emailInput.value = cleanEmail;
                console.log("Cleaned Email:", cleanEmail);

                if (!cleanEmail || !pass) {
                    msg.innerText = "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!";
                    return;
                }

                msg.innerText = "ƒêang k·∫øt n·ªëi (B·∫£n v√° l·ªói)...";

                try {
                    await firebase.auth().signInWithEmailAndPassword(cleanEmail, pass);
                    // onAuthStateChanged in admin.js will catch the success
                    console.log("Login command sent successfully.");
                } catch (e) {
                    console.error("Login Error:", e);
                    // Translate common errors
                    let errorText = e.message;
                    if (e.code === 'auth/invalid-email') errorText = "Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng (D√π ƒë√£ l·ªçc).";
                    if (e.code === 'auth/user-not-found') errorText = "Email n√†y ch∆∞a ƒë∆∞·ª£c ƒëƒÉng k√Ω.";
                    if (e.code === 'auth/wrong-password') errorText = "Sai m·∫≠t kh·∫©u!";

                    msg.innerText = "L·ªói: " + errorText;
                    alert("Chi ti·∫øt l·ªói: " + errorText + "\nEmail g·ª≠i ƒëi: [" + cleanEmail + "]");
                }
            }
        </script>
        <script src="fix_text.js"></script>
</body>

</html>